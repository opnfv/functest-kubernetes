From 4d96b9b0a50bfafdd62f62b92f042dded1626944 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?C=C3=A9dric=20Ollivier?= <cedric.ollivier@orange.com>
Date: Sun, 22 Nov 2020 11:54:05 +0100
Subject: [PATCH] Allow offline testing in PodWithClusterIPSvc
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

It sets edge as image tag for appropriate/curl not to force a download.

Signed-off-by: CÃ©dric Ollivier <cedric.ollivier@orange.com>
---
 tests/unit/tasks/scenarios/test_services.py   | 4 ++--
 xrally_kubernetes/tasks/scenarios/services.py | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/tests/unit/tasks/scenarios/test_services.py b/tests/unit/tasks/scenarios/test_services.py
index 4bbdf77..ea3191f 100644
--- a/tests/unit/tasks/scenarios/test_services.py
+++ b/tests/unit/tasks/scenarios/test_services.py
@@ -81,7 +81,7 @@ class PodWithClusterIPSvcTestCase(test.TestCase):
         self.client.create_job.assert_called_once_with(
             name="test",
             namespace="ns",
-            image="appropriate/curl",
+            image="appropriate/curl:edge",
             command=["curl", "10.0.0.5:3030"],
             status_wait=True
         )
@@ -145,7 +145,7 @@ class PodWithClusterIPSvcTestCase(test.TestCase):
         self.client.create_job.assert_called_once_with(
             name="test",
             namespace="ns",
-            image="appropriate/curl",
+            image="appropriate/curl:edge",
             command=["curl", "192.168.0.3:80"],
             status_wait=True
         )
diff --git a/xrally_kubernetes/tasks/scenarios/services.py b/xrally_kubernetes/tasks/scenarios/services.py
index f1b4fa0..05db477 100644
--- a/xrally_kubernetes/tasks/scenarios/services.py
+++ b/xrally_kubernetes/tasks/scenarios/services.py
@@ -93,7 +93,7 @@ class PodWithClusterIPSvc(common_scenario.BaseKubernetesScenario):
         self.client.create_job(
             name=name,
             namespace=namespace,
-            image="appropriate/curl",
+            image="appropriate/curl:edge",
             command=command,
             status_wait=True
         )
-- 
2.29.2

